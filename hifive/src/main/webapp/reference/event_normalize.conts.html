<!-- CONTENTS_CSS_BEGIN -->
<link rel="stylesheet" href="css/article.css" type="text/css" />
<link type="text/css" rel="stylesheet"
	href="../lib/syntaxhighlighter/styles/SyntaxHighlighter.css"></link>
<!-- CONTENTS_CSS_END -->
<!-- CONTENTS_SCRIPT_BEGIN -->
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript">
	window.onload = function() {
		dp.SyntaxHighlighter.ClipboardSwf = '../lib/syntaxhighlighter/scripts/clipboard.swf';
		dp.SyntaxHighlighter.HighlightAll('code');
	}
</script>
<!-- CONTENTS_SCRIPT_END -->
<!-- CONTENTS_MAIN_BEGIN -->
<div id="contents">
	<h1 class="title">イベントの正規化</h1>
	<div class="contents contents2">
		<input type="hidden" name="contents2Level" value="0"><input
			type="hidden" name="contents2Filter" value=""><input
			type="hidden" name="contents2Count" value="-1"><input
			type="hidden" name="contents2CountLevel" value="0">
		<ul class="list1">
			<li><a href="#capture029175">イベントオブジェクトのoffsetX,
					offsetYプロパティ</a></li>
			<ul class="list2">
				<li><a href="#capture129175">
						currentTargetがsvgタグ、もしくはその(foreignobjectタグ内の要素を除く)子要素の場合 </a></li>
				<ul class="list3">
					<li><a href="#capture229175"> IE, Chrome, Safari </a></li>
					<li><a href="#capture329175"> Firefox </a></li>
					<li><a href="#capture429175"> Opera </a></li>
					<li><a href="#capture529175"> hifiveにおけるsvg関連のoffset </a></li>
				</ul>
			</ul>
		</ul>
		<ul class="list1">
			<li><a href="#capture629175">マウスホイールのイベント名とホイール量</a></li>
		</ul>
	</div>
	<p>hifiveでは、ブラウザによるイベントの非互換性を吸収するため、イベントの正規化を行います。現在のところ、以下の正規化を行っています。</p>
	<a class="anchor_super" id="capture029175"></a><h2>
		イベントオブジェクトのoffsetX, offsetYプロパティ
	</h2>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Firefoxでは、イベントオブジェクトにoffsetX, offsetYプロパティがセットされません。<br>hifiveは、これを自動的に補完します。
			<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>Firefoxでは通常、以下のようにoffsetX, offsetYプロパティを計算しています。<pre
						name="code" class="js">var offset = $(event.currentTarget).offset();
event.offsetX = event.pageX - offset.left;
event.offsetY = event.pageY - offset.top;</pre>
				</li>
			</ul></li>
	</ul>
	<a class="anchor_super" id="capture129175"></a><h3>
		currentTargetがsvgタグ、もしくはその(foreignobjectタグ内の要素を除く)子要素の場合
	</h3>
	<a class="anchor_super" id="capture229175"></a><h4>
		IE, Chrome, Safari
	</h4>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>「その要素(currentTarget)」からのoffset<span class="strong">ではなく</span>、その要素を含むsvgエレメントからのoffsetになっています。
		</li>
		<li>またsvgタグがネストしている場合、その要素を含む最も外側のsvgエレメントからのoffsetになっています。</li>
	</ul>
	<a class="anchor_super" id="capture329175"></a><h4>
		Firefox
	</h4>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>offsetは計算されません。</li>
	</ul>
	<a class="anchor_super" id="capture429175"></a><h4>
		Opera
	</h4>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>「その要素(currentTarget)」からのoffsetになっています。</li>
	</ul>
	<a class="anchor_super" id="capture529175"></a><h4>
		hifiveにおけるsvg関連のoffset
	</h4>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Firefoxは、IE, Chrome, Safariと同じ仕様でoffsetを計算します。
			<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>具体的には以下のようにoffsetX, offsetYプロパティを計算しています。<pre name="code"
						class="js">var offset = $(event.currentTarget.farthestViewportElement).offset();
event.offsetX = event.pageX - offset.left;
event.offsetY = event.pageY - offset.top;</pre>
				</li>
			</ul>
		</li>
		<li>Operaは、svg関連のoffsetも他の要素と同様に、currentTargetからのoffsetX,
			offsetYプロパティが格納されます。
			<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>他のブラウザと同じoffsetの値を求めたい場合、上記のFirefoxと同じコードで計算できます。</li>
			</ul>
		</li>
	</ul>
	<p>
		<a class="anchor" id="mousewheel"></a>
	</p>
	<a class="anchor_super" id="capture629175"></a>
	<h2>
		マウスホイールのイベント名とホイール量
	</h2>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Firefoxでは、マウスホイールのイベント名はDOMMouseScrollで、その他のブラウザはmousewheelです。
			<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>HTML5では、mousewheelがホイールのイベント名です。<br>参考URL: <a
					href="http://www.w3.org/TR/html5/webappapis.html#handler-onmousewheel"
					rel="nofollow">http://www.w3.org/TR/html5/webappapis.html#handler-onmousewheel</a></li>
			</ul>
		</li>
		<li>hifiveでは、mousewheelのイベントハンドラが記述されると、Firefoxの場合DOMMouseScrollイベントに<br>イベントハンドラを登録します。
			<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>登録はDOMMouseScrollイベントに行うので、イベントオブジェクトのタイプは<span
					class="strong">mousewheelではなく、DOMMouseScroll</span>になります。
				</li>
			</ul></li>
		<li>また、イベントオブジェクトのプロパティ<span class="strong">wheelDelta</span>を以下のようにします。<br>
		<span class="strong">すべてのブラウザに対応するためには、値の正負のみを使用し、数値は使用しないようにしてください。</span>
		<ul class="list2" style="padding-left: 12px; margin-left: 12px">
				<li>IE, Chrome, Safari
					<ul class="list3" style="padding-left: 12px; margin-left: 12px">
						<li>ホイールを前に動かすと正の値(120)が、後ろに動かすと負の値(-120)が格納されます。</li>
						<li>ホイールの1目盛りでスクロールする量を取得することはできません。<br>コントロールパネル &gt;
							マウス &gt; ホイール でスクロールする量を変更しても、常に<span class="strong">120</span>,
							<span class="strong">-120</span>が格納されます。
						</li>
					</ul>
				</li>
				<li>Firefox, Opera
					<ul class="list3" style="padding-left: 12px; margin-left: 12px">
						<li>ホイールを前に動かすと正の値が、後ろに動かすと負の値が格納されます。</li>
						<li>ホイールの1目盛りでスクロールする量を取得することができます。<br>コントロールパネル &gt;
							マウス &gt; ホイール でスクロールする量を変更すると、常に<span class="strong">スクロール量
								* 40</span>, <span class="strong">スクロール量 * -40</span>が格納されます。
						</li>
					</ul>
				</li>
			</ul></li>
	</ul>
    <br>
    <br>
	<a href="index.html">←リファレンスへ戻る</a>
</div>
<!-- CONTENTS_MAIN_END -->