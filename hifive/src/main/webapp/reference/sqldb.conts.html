<!-- CONTENTS_CSS_BEGIN -->
<link rel="stylesheet" href="css/article.css" type="text/css" />
<link type="text/css" rel="stylesheet"
	href="../lib/syntaxhighlighter/styles/SyntaxHighlighter.css"></link>
<!-- CONTENTS_CSS_END -->
<!-- CONTENTS_SCRIPT_BEGIN -->
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript">
	window.onload = function() {
		dp.SyntaxHighlighter.ClipboardSwf = '../lib/syntaxhighlighter/scripts/clipboard.swf';
		dp.SyntaxHighlighter.HighlightAll('code');
	}
</script>
<!-- CONTENTS_SCRIPT_END -->
<!-- CONTENTS_MAIN_BEGIN -->
<div id="contents">
	<h1 class="title">WebSQLDB</h1>
	<div class="contents contents2">
		<input type="hidden" name="contents2Level" value="0"><input
			type="hidden" name="contents2Filter" value=""><input
			type="hidden" name="contents2Count" value="-1"><input
			type="hidden" name="contents2CountLevel" value="0">
		<ul class="list1">
			<li><a href="#capture030758">概要 </a></li>
		</ul>
		<ul class="list1">
			<li><a href="#capture130758">API </a></li>
		</ul>
		<ul class="list1">
			<li><a href="#capture230758">使用方法 </a></li>
			<ul class="list2">
				<li><a href="#capture330758"> 手順 </a></li>
				<li><a href="#capture430758">サンプルコード </a></li>
				<ul class="list3">
					<li><a href="#capture530758"> 別トランザクションで実行する場合 </a></li>
					<li><a href="#capture630758"> 同一トランザクションで実行する場合 </a></li>
				</ul>
			</ul>
		</ul>
	</div>
	<a class="anchor_super" id="capture030758"></a><h2>
		概要
	</h2>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>単一のテーブルに対して簡単にCRUD操作が行えます。</li>
		<li>Method chainなインターフェースで、whereやorderByを条件指定やSQLの実行を操作します。</li>
	</ul>
	<p>
		このAPIは、<span class="strong">h5.api.sqldb</span>にアクセスすることで使用できます。
	</p>
	<a class="anchor_super" id="capture130758"></a><h2>
		API
	</h2>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>h5.api.sqldb
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">isSupported</td>
						<td class="style_td" style="">boolean</td>
						<td class="style_td" style="">ブラウザこのサポートしているか。</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">open(String
							name, String version, String displayName, Number estimatedSize)</td>
						<td class="style_td" style="background-color: white;">DatabaseWrapper</td>
						<td class="style_td" style="background-color: white;">データベースに接続します</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<p>サンプルコード</p>
	<pre name="code" class="js">var db = h5.api.sqldb.open('testdb1', '1', 'testdb1', 2 * 1024 * 1024);</pre>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>DatabaseWrapper
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">del(String tableName,
							SQLTransacthionWrapper txw)</td>
						<td class="style_td" style="">Del</td>
						<td class="style_td" style="">削除処理(DELETE)を行うためのオブジェクトを生成します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">insert(String
							tableName, Object/Array values, SQLTransactionWrapper txw)</td>
						<td class="style_td" style="background-color: white;">Insert</td>
						<td class="style_td" style="background-color: white;">登録処理(INSERT)を行うためのオブジェクトを生成します。</td>
					</tr>
					<tr>
						<td class="style_td" style="">select(String tableName, Array
							columns, SQLTransactionWrapper txw)</td>
						<td class="style_td" style="">Select</td>
						<td class="style_td" style="">検索処理(SELECT)を行うためのオブジェクトを生成します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">sql(String
							statement, Array parameters, SQLTransactionWrapper txw)</td>
						<td class="style_td" style="background-color: white;">Sql</td>
						<td class="style_td" style="background-color: white;">指定されたステートメントとパラメータから、SQLを実行するためのオブジェクトを生成します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="">update(String tableName, Object
							values, SQLTransactionWrapper txw)</td>
						<td class="style_td" style="">Update</td>
						<td class="style_td" style="">更新処理(UPDATE)を行うためのオブジェクトを生成します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">transaction(SQLTransactionWrapper
							txw)</td>
						<td class="style_td" style="background-color: white;">Transaction</td>
						<td class="style_td" style="background-color: white;">指定された複数のSQLを同一トランザクションで実行するためのオブジェクトを生成します。</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<p>サンプルコード</p>
	<p>
		<span class="strong">del()</span>
	</p>
	<pre name="code" class="js">var del = db.del('TABLE1');</pre>
	<p>
		<span class="strong">insert()</span>
	</p>
	<pre name="code" class="js">// 1件登録
var insert = db.insert('TABLE1' {id:1, name:'鈴木', age:21});
// 複数件登録
var insert = db.insert('TABLE1' [{id:1, name:'鈴木', age:21}, {id:2, name:'田中', age:34}]);</pre>
	<p>
		<span class="strong">select()</span>
	</p>
	<pre name="code" class="js">// カラムを指定
var select = db.select('TABLE1' ['id', 'age']);
// 全カラム取得
var select = db.select('TABLE1' '*');</pre>
	<p>
		<span class="strong">sql()</span>
	</p>
	<pre name="code" class="js">var sql = db.sql('INSERT INTO TABLE1(id, name, age) VALUES(? ? ?)', [1, '鈴木', '21']);</pre>
	<p>
		<span class="strong">update()</span>
	</p>
	<pre name="code" class="js">var update = db.update('TABLE1' {age:'', age:22});</pre>
	<p>
		<span class="strong">transaction()</span>
	</p>
	<pre name="code" class="js">var transaction = db.transaction();</pre>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Del
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">where(Object/String
							whereObj)</td>
						<td class="style_td" style="background-color: white;">Del</td>
						<td class="style_td" style="background-color: white;">WHERE句を設定します。
						</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Insert
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Select
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">orderBy(Object/String
							orderByObj)</td>
						<td class="style_td" style="background-color: white;">Select</td>
						<td class="style_td" style="background-color: white;">ORDER
							BY句を設定します。</td>
					</tr>
					<tr>
						<td class="style_td" style="">where(Object/String whereObj)</td>
						<td class="style_td" style="">Select</td>
						<td class="style_td" style="">WHERE句を設定します。</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Update
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">where(Object/String
							whereObj)</td>
						<td class="style_td" style="background-color: white;">Update</td>
						<td class="style_td" style="background-color: white;">WHERE句を設定します。
						</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Sql
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>Transaction
			<table class="style_table" cellspacing="1" border="0">
				<thead>
					<tr>
						<td class="style_td" style="">メンバ</td>
						<td class="style_td" style="">戻り値の型</td>
						<td class="style_td" style="">説明</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="style_td" style="">execute()</td>
						<td class="style_td" style="">Promise</td>
						<td class="style_td" style="">このオブジェクトに設定された情報からSQLステートメントとパラメータを生成し、SQLを実行します。
						</td>
					</tr>
					<tr>
						<td class="style_td" style="background-color: white;">add(Del/Insert/Select/Update/Sql
							task)</td>
						<td class="style_td" style="background-color: white;">Transaction</td>
						<td class="style_td" style="background-color: white;">1トランザクションで処理したいSQLをタスクに追加します。
						</td>
					</tr>
				</tbody>
			</table>
		</li>
	</ul>
	<p>
		<span class="strong">Select</span>/<span class="strong">Update</span>/<span
			class="strong">Del</span>のwhere()は、<span class="strong">オブジェクト</span>または<span
			class="strong">文字列</span>で指定します。
	</p>
	<pre name="code" class="js">// オブジェクト
var select = db.select('TABLE1', '*');
select.where({id:10, age:21});
// 文字列
var select2 = db.select('TABLE1', '*');
select2.where('id = 10');</pre>
	<p>
		オブジェクトで指定した場合、上記コードの<span class="strong">{id:10, age:21}</span>は<span
			class="strong">id = 10 AND age = 20</span>と同義です。
	</p>
	<p>
		<span class="strong">Select</span>のorderBy()は、<span class="strong">配列</span>または<span
			class="strong">文字列</span>で指定します。
	</p>
	<pre name="code" class="js">// 配列
var select = db.select('TABLE1', '*');
select.orderBy(['name ASC', 'age DESC']);
// 文字列
var select2 = db.select('TABLE1', '*');
select2.orderBy('name ASC, age DESC');</pre>
	<p>
		<span class="strong">Transaction</span>のadd()は、<span class="strong">Del</span>/<span
			class="strong">Insert</span>/<span class="strong">Select</span>/<span
			class="strong">Update</span>/<span class="strong">Sql</span>オブジェクトを指定します。
	</p>
	<pre name="code" class="js">var insert = db.insert('TABLE1' {id:1, name:'鈴木', age:21});
var select = db.select('TABLE1' ['id', 'age']);
var sql = db.sql('INSERT INTO TABLE1(id, name, age) VALUES(? ? ?)', [1, '鈴木', '21']);
var transaction = db.transaction().add(insert).add(select).add(sql);</pre>
	<p>SQLの実行と結果の取得は以下のように行います。</p>
	<pre name="code" class="js">var select = db.select('TABLE1', '*');
var promise = select.execute();
&nbsp;
promise.done(function(rows) {
&nbsp;&nbsp;&nbsp;// SQL実行成功
});
&nbsp;
promise.fail(function(rows, rows) {
&nbsp;&nbsp;&nbsp;// SQL実行失敗
});</pre>
	<a class="anchor_super" id="capture230758"></a><h2>
		使用方法
	</h2>
	<a class="anchor_super" id="capture330758"></a><h3>
		手順
	</h3>
	<p>以下の手順で、SQLを実行し結果を取得します。</p>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>データベースに接続して、データベースオブジェクト(DatabaseWrapper)を取得。</li>
		<li>データベースオブジェクトを取得して、SQL実行オブジェクト(Sql/Insert/Select/Update/Update/Transaction)を生成。</li>
		<li>SQL実行オブジェクトの<span class="strong">execute()</span>を実行し、Promiseオブジェクトから実行結果を取得する。
		</li>
	</ul>
	<a class="anchor_super" id="capture430758"></a><h3>
		サンプルコード
	</h3>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>テーブル作成・レコードの追加を実行する。</li>
	</ul>
	<a class="anchor_super" id="capture530758"></a><h4>
		別トランザクションで実行する場合
	</h4>
	<pre name="code" class="js">db.sql('CREATE TABLE TABLE1 (col1, col2, col3)').execute().done(function(rs) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.insert(TABLE_NAME, [{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: 1,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: '鈴木',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: 31
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: 2,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: '田中',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: 28
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]).execute().done(function() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('success');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).fail(function(error) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(error.message);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
});</pre>
	<a class="anchor_super" id="capture630758"></a><h4>
		同一トランザクションで実行する場合
	</h4>
	<pre name="code" class="js">db.sql('CREATE TABLE TABLE1 (col1, col2, col3)').execute().progress(function(rs, tx) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db.insert(TABLE_NAME, [{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: 1,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: '鈴木',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: 31
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: 2,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: '田中',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;age: 28
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}], tx).execute().done(function() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert('success');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).fail(function(error) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert(error.message);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
});</pre>
	<p>
		<span class="strong">progress()</span>のコールバックの第一引数には<span
			class="strong">実行結果</span>が、第二引数には<span class="strong">トランザクション</span>が渡されます。このトランザクションオブジェクト<span
			class="strong">Del</span>/<span class="strong">Insert</span>/<span
			class="strong">Select</span>/<span class="strong">Update</span>/<span
			class="strong">Sql</span>/<span class="strong">Transaction</span>オブジェクトに渡して<span
			class="strong">execute()</span>を実行します。
	</p>
	<p>
		トランザクションのクローズ後、<span class="strong">done()</span>または<span
			class="strong">fail()</span>が処理されます。トランザクションが正常に処理された場合、<span
			class="strong">done()</span>が実行されます。トランザクション処理中に例外やSQLの実行に失敗した場合は、<span
			class="strong">fail()</span>が実行されます。<span class="strong">done()</span>のコールバックの第一引数に<span
			class="strong">実行結果</span>が、<span class="strong">fail()</span>のコールバックの第一引数には<span
			class="strong">エラーオブジェクト</span>が渡されます。
	</p>
	<p>オブジェクトによって、渡される実行結果の内容が異なります。</p>
	<table class="style_table" cellspacing="1" border="0">
		<tbody>
			<tr>
				<td class="style_td" style="">Del</td>
				<td class="style_td" style="">変更されたレコード件数</td>
			</tr>
			<tr>
				<td class="style_td" style="background-color: white;">Insert</td>
				<td class="style_td" style="background-color: white;">登録IDを持った配列</td>
			</tr>
			<tr>
				<td class="style_td" style="">Select</td>
				<td class="style_td" style="">検索結果を持つオブジェクト</td>
			</tr>
			<tr>
				<td class="style_td" style="background-color: white;">Update</td>
				<td class="style_td" style="background-color: white;">変更されたレコード件数</td>
			</tr>
			<tr>
				<td class="style_td" style="">Sql</td>
				<td class="style_td" style="">rows(検索結果を持つオブジェクト)・insertId(登録ID)・rowsAffected(変更されたレコード件数)のプロパティをもつオブジェクト</td>
			</tr>
			<tr>
				<td class="style_td" style="background-color: white;">Transaction</td>
				<td class="style_td" style="background-color: white;">add()で追加したSQLの実行結果を全て持つ配列</td>
			</tr>
		</tbody>
	</table>
    <br>
    <br>
    <a href="index.html">←リファレンスへ戻る</a>
</div>
<!-- CONTENTS_MAIN_END -->