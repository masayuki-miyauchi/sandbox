<!-- CONTENTS_CSS_BEGIN -->
<link rel="stylesheet" href="css/article.css" type="text/css" />
<link type="text/css" rel="stylesheet"
	href="../lib/syntaxhighlighter/styles/SyntaxHighlighter.css"></link>
<!-- CONTENTS_CSS_END -->
<!-- CONTENTS_SCRIPT_BEGIN -->
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript"
	src="../lib/syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript">
	window.onload = function() {
		dp.SyntaxHighlighter.ClipboardSwf = '../lib/syntaxhighlighter/scripts/clipboard.swf';
		dp.SyntaxHighlighter.HighlightAll('code');
	}
</script>
<!-- CONTENTS_SCRIPT_END -->
<!-- CONTENTS_MAIN_BEGIN -->
<div id="contents">
	<ul class="menu tutorialIndex">
		<li><a href="step01.html" title="01.準備">01.準備</a></li>
		<li><a href="step02.html" title="02.MVC構造">02.MVC構造</a></li>
		<li><a href="step03.html" title="03.HelloWorld">03.HelloWorld</a></li>
		<li><a href="step04.html" title="04.コントローラ">04.コントローラ</a></li>
		<li><a href="step05.html" title="05.ビュー操作">05.ビュー操作</a></li>
		<li><a href="step06.html" title="06.ロジック">06.ロジック</a></li>
		<li><a href="step07.html" title="07.非同期処理">07.非同期処理</a></li>
		<li><a href="step08.html" title="08.テスト">08.テスト</a></li>
		<li><a href="step09.html" title="09.ドキュメント記述・生成(JSDoc)">09.ドキュメント記述・生成(JSDoc)</a></li>
		<li><a href="step10.html" title="10.サンプルアプリ（動画検索アプリの作成）">10.サンプルアプリ（動画検索アプリの作成）</a></li>
		<li><a href="step11.html" title="11.スマートフォン対応（jQueryMobileとの連携）">11.スマートフォン対応（jQueryMobileとの連携）</a></li>
		<li><a href="step12.html" title="12.HTML5APIの利用">12.HTML5APIの利用</a></li>
        <li><a href="step13.html" title="13.AOP(アスペクトの適用)">13.AOP(アスペクトの適用)</a></li>
	</ul>
	<h1 class="title">チュートリアル06.ロジック</h1>
	<div class="contents contents2">
		<input type="hidden" name="contents2Level" value="0"><input
			type="hidden" name="contents2Filter" value=""><input
			type="hidden" name="contents2Count" value="-1"><input
			type="hidden" name="contents2CountLevel" value="0">
		<ul class="list1">
			<li><a href="#capture022131"> 概要 </a></li>
		</ul>
		<ul class="list1">
			<li><a href="#capture122131"> ロジックの定義 </a></li>
		</ul>
		<ul class="list1">
			<li><a href="#capture222131">実装例 </a></li>
			<ul class="list2">
				<li><a href="#capture322131"> 動作確認 </a></li>
			</ul>
		</ul>
		<ul class="list1">
			<li><a href="#capture422131"> ロジック化されることによって追加されるメソッド </a></li>
			<ul class="list2">
				<li><a href="#capture522131"> deferred </a></li>
			</ul>
		</ul>
		<ul class="list1">
			<li><a href="#capture622131">よくある質問 </a></li>
			<ul class="list2">
				<li><a href="#capture722131">どうしてロジックで画面操作をしてはいけないの？ </a></li>
			</ul>
		</ul>
	</div>
	<a class="anchor_super" id="capture022131"></a><h2>
		概要
	</h2>
	<p>hifiveでは、「ロジック」は</p>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>計算</li>
		<li>サーバとの通信</li>
		<li>ローカルDBとのやり取り</li>
	</ul>
	<p>
		などの<span class="strong">純粋な（画面操作を含まない）通信・計算処理のみを記述するもの</span>と定めています。
	</p>
	<p>
		「処理」だけをまとめることによって、可読性・保守性・再利用性・テスト容易性が向上します。<br>また、次のステップで紹介する非同期処理機構を用いることで、<br>ロジックの内部実装の変更がコントローラに影響しないようにすることができます。
	</p>
	<a class="anchor_super" id="capture122131"></a><h2>
		ロジックの定義
	</h2>
	<p>ロジックは以下のように定義します。</p>
	<ol class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>ロジックを定義する<pre name="code" class="js">function DateLogic(){};
DateLogic.prototype = {
&nbsp;
&nbsp;&nbsp;__name: 'DateLogic',
&nbsp;
&nbsp;&nbsp;dateFormat: '{0}年{1}月{2}日',
&nbsp;
&nbsp;&nbsp;getCurrent: function(time) {
&nbsp;&nbsp;&nbsp;&nbsp;var year = time.getYear();
&nbsp;&nbsp;&nbsp;&nbsp;var month = time.getMonth() + 1;
&nbsp;&nbsp;&nbsp;&nbsp;var date = time.getDate();
&nbsp;&nbsp;&nbsp;&nbsp;return this._format(year, month, date);
&nbsp;&nbsp;},
&nbsp;
&nbsp;&nbsp;_format: function(year, month, date) {
&nbsp;&nbsp;&nbsp;&nbsp;return h5.u.str.format(this.dateFormat, year, month, date);
&nbsp;&nbsp;}
};</pre>
			<dl class="list1" style="padding-left: 12px; margin-left: 12px">
				<dt>__name</dt>
				<dd>
					ロジック名を指定します。コントローラと同様<span style="color: red; background-color:">必須プロパティ</span>であり、記述がない場合エラーが発生します。
				</dd>
				<dt>publicMethod</dt>
				<dd>
					パブリックメソッドは<span class="strong">_</span>以外の文字で始まるようにします。
				</dd>
				<dt>_privateMethod</dt>
				<dd>
					プライベートメソッドは<span class="strong">_</span>で始まるようにします。
					<div class="spacer">&nbsp;</div>
				</dd>
			</dl>
		<li>コントローラでロジックを宣言する<pre name="code" class="js">var dateController = {
&nbsp;&nbsp;__name: 'DateController',
&nbsp;
&nbsp;&nbsp;dateLogic: new DateLogic(),
&nbsp;
&nbsp;&nbsp;__ready: function(context) {
&nbsp;&nbsp;&nbsp;&nbsp;var current = this.dateLogic.getCurrent(new Date());
&nbsp;&nbsp;&nbsp;&nbsp;alert(current);
&nbsp;&nbsp;}
};</pre>
		</li>
	</ol>
	<a class="anchor_super" id="capture222131"></a><h2>
		実装例
	</h2>
	<ol class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>HTMLを用意します。<pre name="code" class="xml">&lt;!doctype html&gt;
&lt;html&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta charset="UTF-8"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="jquery.js"&gt;&lt;/script&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="jquery.blockUI.js"&gt;&lt;/script&gt;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="ejs-1.0.h5mod.js"&gt;&lt;/script&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="h5.js"&gt;&lt;/script&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ここで作成したjsファイルを読み込む --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="step6.js"&gt;&lt;/script&gt;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;hifive Step2&lt;/title&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div id="container"&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="text" id="left" value="" /&gt; +
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="text" id="right" value="" /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="button" id="calc" value="=" /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span id="result"&gt; &lt;/span&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;
&lt;/html&gt;</pre>
			<div class="spacer">&nbsp;</div>
		</li>
		<li>step6.jsというファイルを作成します。<pre name="code" class="js">$(function() {
&nbsp;&nbsp;&nbsp;&nbsp;// ロジックのコンストラクタを定義
&nbsp;&nbsp;&nbsp;&nbsp;function CalcLogic() {}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;// メソッドを定義
&nbsp;&nbsp;&nbsp;&nbsp;CalcLogic.prototype = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__name: 'CalcLogic',
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add: function(left, right) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return left + right;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;// コントローラの元となるオブジェクトを作成
&nbsp;&nbsp;&nbsp;&nbsp;var controller = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// コントローラ名
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__name: 'CalcController',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ロジックの宣言
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calcLogic: new CalcLogic(),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'#calc click': function() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 左辺の値を取得
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var left = $('#left').val();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//値がなければ処理を終了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!left) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// StringからNumberへ変換。変換に失敗したら終了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;left = parseInt(left);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch(e) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 右辺の値を取得
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var right = $('#right').val();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//値がなければ処理を終了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!right) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// StringからNumberへ変換。変換に失敗したら終了
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right = parseInt(right);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch(e) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// CalcLogicのaddメソッドを呼び出す
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ret = this.calcLogic.add(left, right);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 結果を画面に出力
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.$find('#result').html(ret);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;// id="container"である要素にコントローラをバインド
&nbsp;&nbsp;&nbsp;&nbsp;h5.core.controller('#container', controller);
});</pre>
			<div class="spacer">&nbsp;</div>
		</li>
		<li>HTMLをブラウザで表示させます。</li>
		<li>左辺、右辺に数値を入力し<span class="strong">=</span>ボタンをクリックします。
		</li>
	</ol>
	<a class="anchor_super" id="capture322131"></a><h3>
		動作確認
	</h3>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li><a
			href="./step6/step6.html"
			rel="nofollow">チュートリアル/step6</a></li>
	</ul>
	<a class="anchor_super" id="capture422131"></a><h2>
		ロジック化されることによって追加されるメソッド
	</h2>
	<p>ロジック化されると以下のメソッドが追加されます。</p>
	<a class="anchor_super" id="capture522131"></a><h3>
		deferred
	</h3>
	<pre name="code" class="js">deferred()</pre>
	<p>Deferredオブジェクトを返します。</p>
	<p>Deferredを使った実装例は次のステップで説明します。</p>
	<a class="anchor_super" id="capture622131"></a><h2>
		よくある質問
	</h2>
	<a class="anchor_super" id="capture722131"></a><h3>
		どうしてロジックで画面操作をしてはいけないの？
	</h3>
	<p>
		ロジックで行うような処理、すわなち通信・計算処理と画面更新処理を混ぜてしまうと、<br>ビュー（タグ）の構造を変えたい、スタイルを少し変えたいといったときにJavaScriptコードまで<br>読み解いて手を入れなければならなくなります。<br>逆に、処理が変わった時に画面操作が混ざってしまっているため、保守性が低下してしまいます。<br>さらに、jQuery等で複雑なタグ構造を生成すると最終的にタグがどうなるかが<br>非常にわかりにくくなってしまい、これもメンテナンス性を落とす原因となります。
	</p>
	<p>そのため、</p>
	<ul class="list1" style="padding-left: 12px; margin-left: 12px">
		<li>最初に書くときにはほんの少し手間はかかるかもしれませんが</li>
		<li>仕様上はロジック内でビューを操作することもできてしまいますが</li>
	</ul>
	<p>指針に従って処理を分離しておくことを強くお勧めしています。</p>
	<p>また、ビュー操作を楽にするために、テンプレートエンジンなども提供しています。</p>
	<div class="spacer">&nbsp;</div>
	<div class="spacer">&nbsp;</div>
	<div style="text-align: center">ロジックを画面操作から独立させておくことは、通信など非同期処理を行う場合に真価を発揮します。</div>
	<div style="text-align: center">次は、その非同期処理の扱い方について説明します。</div>
	<div style="text-align: center">
		<span
			style="font-size: 18px; display: inline; line-height: 130%; text-indent: 0px">次のステップ⇒<a
			href="step07.html">チュートリアル07.非同期処理</a></span>
	</div>

</div>
<!-- CONTENTS_MAIN_END -->