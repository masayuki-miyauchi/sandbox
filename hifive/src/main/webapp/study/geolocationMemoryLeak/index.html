<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<script src="test.js"></script>
<title>Memory Leak Test</title>
<script>
(function() { // 即時関数の有無はリークに関係しない
	navigator.appCodeName;
	navigator.appMonitorVersion;
	navigator.appName;
	navigator.appVersion;
	navigator.browserLanguage;
	navigator.cookieEnabled;
	navigator.cpuClass;
	navigator.geolocation; // このプロパティでのみリークする
	navigator.javaEnabled;
	navigator.mimeTypes;
	navigator.msDoNotTrack;
	navigator.onLine;
	navigator.platform;
	navigator.plugins;
	navigator.systemLanguage;
	navigator.taintEnabled;
	navigator.userAgent;
	navigator.userLanguage;
})();
</script>
</head>
<body>
<h4>以下の条件に全て該当すると、メモリリークが発生する。</h4>
<ul>
 <li>navigatorを変数で受ける。※1</li>
 <li>オブジェクトを生成し、そのオブジェクトから※1をキャプチャする。※2</li>
 <li>※2のオブジェクトをグローバルに紐付ける</li>
 <li>navigator.geolocationを実行する。(実行する場所はどこでもよい)</li>
</ul>

結果、※2のオブジェクトがリークする。

<h4>タスクマネージャを開いてメモリサイズを確認して下さい。</h4>
<ul>
 <li>IE9: 920Mずつ増える。</li>
 <li>Opera 11/Safari 5.1/Chrome 16/FireFox 6: リークせず。</li>
</ul>
</body>
</html>